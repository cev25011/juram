<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 AI ë¡œë´‡ë§ì¹˜ ê²Œì„</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        body { text-align: center; font-family: 'Malgun Gothic', sans-serif; background: #121212; color: #ffffff; margin: 0; padding: 20px; }
        .container { position: relative; display: inline-block; border: 5px solid #3498db; border-radius: 20px; background: #000; box-shadow: 0 0 20px rgba(52,152,219,0.5); }
        canvas { transform: rotateY(180deg); display: block; max-width: 100%; border-radius: 15px; }
        .ui-card { margin: 20px auto; max-width: 600px; padding: 20px; background: #1e1e1e; border-radius: 15px; border: 1px solid #333; }
        button { padding: 15px 25px; font-size: 18px; font-weight: bold; cursor: pointer; border: none; border-radius: 10px; transition: 0.3s; margin: 10px; }
        #btn-serial { background: #e67e22; color: white; }
        #btn-game { background: #2ecc71; color: white; }
        button:hover { transform: scale(1.05); opacity: 0.9; }
        #status-msg { color: #f1c40f; font-weight: bold; margin-bottom: 10px; }
        #result-box { font-size: 2.5rem; font-weight: bold; color: #e74c3c; min-height: 60px; margin: 15px 0; }
        .badge { background: #34495e; padding: 8px 15px; border-radius: 30px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <h1>ğŸ¤– AI ê°€ìœ„ë°”ìœ„ë³´ ë¡œë´‡ë§ì¹˜</h1>
    
    <div class="container">
        <!-- ì¹´ë©”ë¼ ì˜ìƒì´ ì¶œë ¥ë˜ëŠ” ê³³ -->
        <canvas class="output_canvas" width="640" height="480"></canvas>
        <video class="input_video" style="display:none;"></video>
    </div>

    <div class="ui-card">
        <div id="status-msg">ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.</div>
        <button id="btn-serial">1. ì•„ë‘ì´ë…¸(USB) ì—°ê²°</button>
        <button id="btn-game">2. ê²Œì„ ì‹œì‘!</button>
        <br><br>
        <span class="badge">ì¸ì‹ëœ ì†: <span id="hand-label">ì—†ìŒ</span></span>
        <div id="result-box">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <script>
        const videoElement = document.querySelector('.input_video');
        const canvasElement = document.querySelector('.output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusMsg = document.getElementById('status-msg');
        const resultBox = document.getElementById('result-box');
        const handLabel = document.getElementById('hand-label');
        
        let port;
        let currentGesture = "";

        // [1] USB ì‹œë¦¬ì–¼ ì—°ê²° í•¨ìˆ˜
        document.getElementById('btn-serial').onclick = async () => {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 9600 });
                statusMsg.innerText = "âœ… ì•„ë‘ì´ë…¸ ì—°ê²° ì„±ê³µ!";
                statusMsg.style.color = "#2ecc71";
            } catch (err) {
                statusMsg.innerText = "âŒ ì—°ê²° ì‹¤íŒ¨: " + err.message;
            }
        };

        // [2] ì•„ë‘ì´ë…¸ë¡œ 'H' ì‹ í˜¸ ë³´ë‚´ê¸°
        async function sendHammerSignal() {
            if (port && port.writable) {
                const writer = port.writable.getWriter();
                const data = new Uint8Array([72]); // ASCII 'H'
                await writer.write(data);
                writer.releaseLock();
            }
        }

        // [3] ì†ë™ì‘ ì¸ì‹ ì²˜ë¦¬ (MediaPipe)
        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 3});

                // ì†ê°€ë½ ë(Tips)ê³¼ ë§ˆë””(Pips) ì¢Œí‘œ ë¹„êµë¡œ íŒì •
                const indexOpen = landmarks[8].y < landmarks[6].y;
                const middleOpen = landmarks[12].y < landmarks[10].y;
                const ringOpen = landmarks[16].y < landmarks[14].y;
                const pinkyOpen = landmarks[20].y < landmarks[18].y;

                if (indexOpen && middleOpen && ringOpen && pinkyOpen) currentGesture = "ë³´";
                else if (indexOpen && middleOpen && !ringOpen) currentGesture = "ê°€ìœ„";
                else if (!indexOpen && !middleOpen) currentGesture = "ë°”ìœ„";
                else currentGesture = "ì¸ì‹ ì¤‘...";
                
                handLabel.innerText = currentGesture;
            } else {
                handLabel.innerText = "ì† ì—†ìŒ";
            }
            canvasCtx.restore();
        }

        // [4] ê²Œì„ ìŠ¹íŒ¨ ë¡œì§
        document.getElementById('btn-game').onclick = () => {
            if (!currentGesture || currentGesture === "ì¸ì‹ ì¤‘...") {
                alert("ì¹´ë©”ë¼ì— ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”!");
                return;
            }

            const rps = ["ê°€ìœ„", "ë°”ìœ„", "ë³´"];
            const computer = rps[Math.floor(Math.random() * 3)];
            
            if (currentGesture === computer) {
                resultBox.innerText = `ë¬´ìŠ¹ë¶€! (ì»´: ${computer})`;
                resultBox.style.color = "#f1c40f";
            } else if (
                (currentGesture === "ê°€ìœ„" && computer === "ë°”ìœ„") ||
                (currentGesture === "ë°”ìœ„" && computer === "ë³´") ||
                (currentGesture === "ë³´" && computer === "ê°€ìœ„")
            ) {
                resultBox.innerText = `íŒ¨ë°°! ğŸ”¨ (ì»´: ${computer})`;
                resultBox.style.color = "#e74c3c";
                sendHammerSignal(); // íŒ¨ë°° ì‹œ ì•„ë‘ì´ë…¸ ì‘ë™
            } else {
                resultBox.innerText = `ìŠ¹ë¦¬! ğŸ‰ (ì»´: ${computer})`;
                resultBox.style.color = "#2ecc71";
            }
        };

        // [5] ì¹´ë©”ë¼ ì‹œì‘ ë° ì„¤ì •
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net{file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });

        // ì¹´ë©”ë¼ ì‹¤í–‰ ë° ì˜¤ë¥˜ ê°ì§€
        camera.start()
            .then(() => statusMsg.innerText = "âœ… ì¹´ë©”ë¼ ì¤€ë¹„ ì™„ë£Œ. ì•„ë‘ì´ë…¸ë¥¼ ì—°ê²°í•˜ì„¸ìš”.")
            .catch((err) => statusMsg.innerText = "âŒ ì¹´ë©”ë¼ ì˜¤ë¥˜: " + err.message);
    </script>
</body>
</html>
