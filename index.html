<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI ë¡œë´‡ë§ì¹˜ ê²Œì„ (í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì¶”ê°€)</title>
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ ë³´ê°• -->
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        body { text-align: center; font-family: 'Malgun Gothic', sans-serif; background: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .container { position: relative; display: inline-block; border: 5px solid #444; border-radius: 20px; background: #000; overflow: hidden; }
        canvas { transform: rotateY(180deg); display: block; max-width: 100%; height: auto; }
        .info-card { margin: 20px auto; max-width: 600px; padding: 20px; background: #2d2d2d; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        button { padding: 15px 25px; font-size: 18px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; transition: 0.3s; margin: 5px; }
        #btn-serial { background: #f39c12; color: white; }
        #btn-game { background: #27ae60; color: white; }
        #btn-test { background: #3498db; color: white; } /* ìƒˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button:hover { opacity: 0.8; transform: scale(1.05); }
        #status { color: #f1c40f; font-size: 1.1rem; margin-bottom: 10px; }
        #result-display { font-size: 2.5rem; font-weight: bold; color: #e74c3c; margin: 15px 0; min-height: 60px; }
    </style>
</head>
<body>
    <h1>âœŠâœŒï¸âœ‹ AI ë¡œë´‡ë§ì¹˜ (2026 Edition)</h1>
    
    <div class="container">
        <canvas class="output_canvas" width="640" height="480"></canvas>
        <video class="input_video" style="display:none;"></video>
    </div>

    <div class="info-card">
        <div id="status">ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘... ì•„ë‘ì´ë…¸ë¥¼ ì—°ê²°í•˜ì„¸ìš”.</div>
        <button id="btn-serial">1. ì•„ë‘ì´ë…¸(USB/HC-06) ì—°ê²°</button>
        <button id="btn-game">2. ê²Œì„ ì‹œì‘!</button>
        <!-- ì„œë³´ëª¨í„° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì¶”ê°€ -->
        <button id="btn-test">3. ì„œë³´ëª¨í„° í…ŒìŠ¤íŠ¸ (H ì „ì†¡)</button>
        <div id="result-display">ì¤€ë¹„í•˜ì„¸ìš”!</div>
    </div>

    <script>
        const videoElement = document.querySelector('.input_video');
        const canvasElement = document.querySelector('.output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusText = document.getElementById('status');
        const resultText = document.getElementById('result-display');
        
        let port;
        let currentGesture = "";

        // 1. ì•„ë‘ì´ë…¸ ì—°ê²° (Web Serial API)
        document.getElementById('btn-serial').onclick = async () => {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 38400 });
                statusText.innerText = "âœ… ê¸°ê¸° ì—°ê²° ì„±ê³µ! (ì‹œë¦¬ì–¼ í¬íŠ¸ ê°œë°©)";
                statusText.style.color = "#2ecc71";
            } catch (err) {
                statusText.innerText = "âŒ ì—°ê²° ì‹¤íŒ¨: " + err.message;
            }
        };

        // 2. 'H' ì‹ í˜¸ ì „ì†¡ (í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì´ ì´ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤)
        async function hitHammer() {
            if (port && port.writable) {
                const writer = port.writable.getWriter();
                try {
                    const data = new Uint8Array([72]); // ASCII 'H' ì „ì†¡
                    await writer.write(data);
                    console.log("ì‹ í˜¸ 'H' ì „ì†¡ ì™„ë£Œ");
                    resultText.innerText = "ğŸ”¨ í…ŒìŠ¤íŠ¸ ì‹ í˜¸ ì „ì†¡ë¨!";
                    resultText.style.color = "#3498db";
                } catch (error) {
                    console.error("ë°ì´í„° ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                } finally {
                    writer.releaseLock();
                }
            } else {
                alert("ë¨¼ì € '1. ì•„ë‘ì´ë…¸ ì—°ê²°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!");
            }
        }
        
        // 3. í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('btn-test').onclick = hitHammer;

        // 4. MediaPipe ì† ì¸ì‹ (ì¹´ë©”ë¼ê°€ ì•ˆ ëœ° ê²½ìš° ë¬´ì‹œí•´ë„ ë©ë‹ˆë‹¤)
        function onResults(results) { /* ... ê¸°ì¡´ê³¼ ë™ì¼ ... */
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks;
                const indexOpen = landmarks.y < landmarks.y; const middleOpen = landmarks.y < landmarks.y; const ringOpen = landmarks.y < landmarks.y; const pinkyOpen = landmarks.y < landmarks.y;
                if (indexOpen && middleOpen && ringOpen && pinkyOpen) currentGesture = "ë³´";
                else if (indexOpen && middleOpen && !ringOpen) currentGesture = "ê°€ìœ„";
                else if (!indexOpen && !middleOpen && !ringOpen && !pinkyOpen) currentGesture = "ë°”ìœ„";
                statusText.innerText = "ê°ì§€ë¨: " + currentGesture;
            }
            canvasCtx.restore();
        }

        // 5. ê²Œì„ ë¡œì§ (hitHammer() í˜¸ì¶œ ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
        document.getElementById('btn-game').onclick = () => {
            /* ... ê¸°ì¡´ ê²Œì„ ë¡œì§ê³¼ ë™ì¼ ... */
            if (!currentGesture) { alert("ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”!"); return; }
            const rps = ["ê°€ìœ„", "ë°”ìœ„", "ë³´"]; const computer = rps[Math.floor(Math.random() * 3)];
            if (currentGesture === computer) { resultText.innerText = `ë¬´ìŠ¹ë¶€! (ì»´:${computer})`; resultText.style.color = "#f1c40f"; } 
            else if ((currentGesture === "ê°€ìœ„" && computer === "ë°”ìœ„") || (currentGesture === "ë°”ìœ„" && computer === "ë³´") || (currentGesture === "ë³´" && computer === "ê°€ìœ„")) {
                resultText.innerText = `íŒ¨ë°°! ğŸ”¨ (ì»´:${computer})`; resultText.style.color = "#e74c3c";
                hitHammer(); // íŒ¨ë°° ì‹œ ì‹ í˜¸ ì „ì†¡
            } else { resultText.innerText = `ìŠ¹ë¦¬! ğŸ‰ (ì»´:${computer})`; resultText.style.color = "#2ecc71"; }
        };

        // 6. MediaPipe ë° ì¹´ë©”ë¼ ì„¤ì •
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net{file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
        hands.onResults(onResults);
        const camera = new Camera(videoElement, { onFrame: async () => { await hands.send({image: videoElement}); }, width: 640, height: 480 });
        camera.start().then(() => { statusText.innerText = "âœ… ì¹´ë©”ë¼ ì¤€ë¹„ ì™„ë£Œ! ì•„ë‘ì´ë…¸ë¥¼ ì—°ê²°í•˜ì„¸ìš”."; }).catch(err => { statusText.innerText = "âŒ ì¹´ë©”ë¼ ì˜¤ë¥˜: " + err.message; });
    </script>
</body>
</html>
